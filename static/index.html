<html>
<head>
<title>mortimint</title>
<script src="lodash.min.js"></script>
</head>
<body>
<h1>mortimint</h1>
<div>
  <a href="/progress">progress</a>
  <br/>
  <a href="/emit/">emit</a>
  <br/>
  <a href="/emit/emit.dict">emit.dict</a>
  <br/>
  <a href="/emit/emit.log">emit.log</a>
</div>
<pre class="progress">...</pre>
<script>
function showProgress() {
  fetch('./progress')
    .then(function(response) {
      if (response.status == 200) {
        // Examine the text in the response
        response.json().then(function(data) {
          var pcts = {};
          for (var dir in data.FileSizes) {
            for (var fname in data.FileSizes[dir]) {
              var size = data.FileSizes[dir][fname];
              var curr = _.get(data.FileProgress, [dir, fname], 0);
              _.set(pcts, [dir, fname], curr / size);
            }
          }

          var progressEl = document.getElementsByClassName('progress')[0];
          progressEl.innerText = JSON.stringify(pcts, null, 2);

          if (data.EmitDone) {
            progressEl.className += " done";
          } else {
            setTimeout(showProgress, 1500);
          }
        });
      }
    })
    .catch(function(err) {
      document.getElementsByClassName('progress')[0].innerText = err;
      console.log('fetch error :-S', err);
    });
}
showProgress();
</script>
<div class="tall">
</div>
<div>
  hi
</div>
<style>
.tall {
  position: relative;
  min-height: 100000px;
}
</style>
</body>
</html>
